{
  "id": "gojowtf",
  "name": "GojoWtf",
  "version": "1.1.1",
  "manifestURI": "YOUR_RAW_MANIFEST_URL_HERE",
  "language": "typescript",
  "type": "onlinestream-provider",
  "description": "GojoWtf is an online streaming platform for English-subbed and dubbed anime. Supports multiple providers.",
  "author": "YOUR_NAME_HERE",
  "icon": "",
  "website": "",
  "lang": "en",
  "payload": "(function(){const baseUrl='https://animetsu.to';const api=`https://backend.${baseUrl.split('://')[1].split('/')[0]}/api/anime`;const headers={'Referer':baseUrl,'User-Agent':'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36'};const threshold=0.7;function normalizeQuery(q){return q.replace(/Season/gi,'').replace(/\\b(\\d+)(st|nd|rd|th)\\b/g,'$1').replace(/\\s*\\([^)]*\\)\\s*/g,'').replace(/\\s+/g,' ').trim().toLowerCase()}async function makeRequest(url){try{const r=await fetch(url,{method:'GET',headers});if(!r.ok)throw new Error(r.statusText);return await r.text()}catch(e){console.error(e);return ''}}function filterBySimilarity(input,candidates,t){let valid=candidates.map(c=>({title:c,score:1-(Array.from(normalizeQuery(input)).reduce((acc,ch,i)=>acc+(ch!==normalizeQuery(c)[i]?1:0),0)/Math.max(input.length,c.length))})).filter(x=>x.score>=t);return valid.length?valid.reduce((p,c)=>p.score>c.score?p:c).score:null}return {id:'gojowtf',name:'GojoWtf',supportsDub:true,episodeServers:['pahe','zoro','zaza','bato','megg'],search:async function(query){try{let normalizedQuery=query.query;let language=query.dub?'dub':'sub';let url=`${api}/search?query=${encodeURIComponent(normalizedQuery)}&page=1&year=${query.year!=null?query.year:'any'}`;let response=await makeRequest(url);let data=JSON.parse(response);if(data?.total==0){url=`${api}/search?query=${encodeURIComponent(query.query)}&page=1&year=${query.year!=null?query.year:'any'}`;response=await makeRequest(url);data=JSON.parse(response)}const pages=data.lastPage;const titles=[query.media.englishTitle??'',query.media.romajiTitle??'',...query.media.synonyms];const validTitles=new Map();const results=[];let shouldContinue=true;for(let i=1;i<=pages;i++){if(i>1){url=`${url.split('&page')[0]}&page=${i}`;response=await makeRequest(url);data=JSON.parse(response)}for(let anime of data.results){let japaneseTitle=anime.title.romaji;let title=anime.title.english;let nativeTitle=anime.title.native;let id=anime.id;let epUrl=`${baseUrl}/anime/${id}`;let subOrDub=query.dub?'dub':'sub';for(let t of [japaneseTitle,title,nativeTitle]){let bestScore=filterBySimilarity(t,titles,threshold);if(bestScore!=null){validTitles.set(title,{score:bestScore,subOrDub,title});if(bestScore==1){shouldContinue=false;break}}}results.push({id:`${id}/${subOrDub}`,title,url:epUrl,subOrDub});if(!shouldContinue)break}if(!shouldContinue)break}if(validTitles.size>0){let bestMatch=Array.from(validTitles.values()).reduce((p,c)=>p.score>c.score?p:c);let animeToReturn=results.filter(a=>a.subOrDub==(query.dub?'dub':'sub')).filter(a=>a.title.toLowerCase()===bestMatch.title.toLowerCase())[0];if(animeToReturn)return [animeToReturn]}throw new Error('No results found')}catch(e){console.error(e);throw new Error(e)}},findEpisodes:async function(id){try{let url=`${api}/eps/${id.split('/dub')[0].split('/sub')[0]}`;let response=await makeRequest(url);let data=JSON.parse(response);return data.map(ep=>({id:`id=${id.split('/dub')[0].split('/sub')[0]}&num=${ep.number}&subType=${id.includes('/dub')?'dub':'sub'}`,number:ep.number,url:'',title:ep.title}))}catch(e){console.error(e);throw new Error(e)}},findEpisodeServer:async function(episode,_server){try{let server=_server!=='default'?_server:'zaza';let response=await makeRequest(`${api}/tiddies?provider=${_server}&id=${episode.id}`);let data=JSON.parse(response);if(!data?.sources?.length)throw new Error('No sources found');let videoSources=data.sources.map(s=>({url:s.url.replace(/[\r\n]+/g,'').trim(),type:s.url.includes('m3u8')?'m3u8':'mp4',quality:s.quality,subtitles:[]}));return{headers,server,videoSources}}catch(e){console.error(e);throw new Error(e)}}}})()"
}
